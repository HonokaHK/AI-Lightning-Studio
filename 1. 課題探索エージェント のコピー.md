# **課題探索エージェント 仕様書**

**Problem Discovery Agent – Lean Startup Companion**

---

## **1\. 概要**

### **1.1 目的**

本エージェントは、リーンスタートアップおよび Jobs-to-be-Done 理論に基づき、  
 ユーザーの自由記述から

* 解決すべき **ジョブ**

* ジョブが発生する **付帯状況**

* **課題・不満（Pain）**

* **現状対策とその限界**

* **残課題（Unmet Needs）**

を構造化し、  
 **後続フェーズ（質問設計・課題定義・価値定義・実験設計）が迷わず進められる状態**を作る。

---

### **1.2 本エージェントの位置づけ**

* リーンスタートアップ伴走エージェントの **Phase 1**

* 人間の意思決定を妨げないため **Human Gate 不要**

* 情報不足時はユーザーと **対話的に往復**する前提

---

## **2\. フェーズ定義**

| 項目 | 内容 |
| ----- | ----- |
| フェーズ名 | `problem_discovery` |
| フェーズ番号 | Phase 1 |
| 主目的 | 課題の言語化・構造化 |
| 次フェーズ | Phase 2：質問設計エージェント |
| 再実行条件 | 情報不足・品質不足の場合 |

---

## **3\. 入出力仕様**

### **3.1 入力（Input）**

| 項目 | 型 | 必須 | 説明 |
| ----- | ----- | ----- | ----- |
| `userFreeText` | string | 必須 | ユーザーの自由記述（課題感・違和感・困りごと） |
| `projectMeta` | object | 任意 | 業界、想定顧客、制約、既存アセットなど |
| `history` | array | 任意 | 同一プロジェクト内の会話履歴（contextLoader注入） |

---

### **3.2 出力（Output）**

#### **保存先（Firestore）**

`{projectId}/phase/problem_discovery`

#### **出力構成**

* `problemStatement`（1文サマリ）

* `problemDiscoverySheet`（構造化データ）

* `followupQuestions`（不足時のみ）

* `qualityReport`（品質・次アクション）

---

## **4\. 出力JSONスキーマ（固定）**

`{`  
  `"problemStatement": "誰が/いつ/どこで/何を達成したいが/何が障害で困っている",`  
  `"problemDiscoverySheet": {`  
    `"job": {`  
      `"main": "",`  
      `"functional": [],`  
      `"emotional": [],`  
      `"social": []`  
    `},`  
    `"context": {`  
      `"who": "",`  
      `"when": "",`  
      `"where": "",`  
      `"trigger": "",`  
      `"constraints": [],`  
      `"stakeholders": []`  
    `},`  
    `"pains": [`  
      `{`  
        `"pain": "",`  
        `"impact": "",`  
        `"severity": 1,`  
        `"frequency": 1,`  
        `"evidence": ""`  
      `}`  
    `],`  
    `"currentSolutions": [`  
      `{`  
        `"solution": "",`  
        `"whyChosen": "",`  
        `"dissatisfaction": ""`  
      `}`  
    `],`  
    `"unmetNeeds": [`  
      `{`  
        `"need": "",`  
        `"whyDepth": []`  
      `}`  
    `],`  
    `"emotion": {`  
      `"feelings": [],`  
      `"momentOfTruth": ""`  
    `},`  
    `"successCriteria": [],`  
    `"assumptions": [],`  
    `"unknowns": []`  
  `},`  
  `"followupQuestions": [`  
    `{`  
      `"question": "",`  
      `"intent": "",`  
      `"type": "open"`  
    `}`  
  `],`  
  `"qualityReport": {`  
    `"confidence": 0.0,`  
    `"missingFields": [],`  
    `"contradictions": [],`  
    `"nextAction": "proceed"`  
  `}`  
`}`

---

## **5\. 処理ロジック（アルゴリズム仕様）**

### **Step 1\. 情報抽出**

* 自由記述から以下を抽出

  * 主ジョブ（動詞＋目的語）

  * 付帯状況（who / when / where / trigger）

  * 困りごと（pains）

  * 現状対策（currentSolutions）

---

### **Step 2\. Why 深掘り（why\_depth \= 5）**

* `severity × frequency` が高い pain **上位2件まで**

* Whyを最大5段階で掘り、`unmetNeeds` に格納

---

### **Step 3\. 不足判定**

以下に該当する場合、追加質問を生成する。

* `job.main` が曖昧

* `context.trigger` が不明

* `pains` が抽象的（影響・頻度・重大度が不明）

* `currentSolutions` が存在しない

→ `qualityReport.nextAction = "ask_more"`

---

### **Step 4\. problemStatement 生成**

以下のテンプレで1文に要約：

「◯◯な人が、△△の状況で、□□を達成したいが、××が障害になって困っている」

---

## **6\. Prompt設計（System Prompt）**

※ **出力は必ずJSONのみ**

`あなたは「課題探索エージェント」です。`  
`Jobs-to-be-Done理論とリーンスタートアップの考え方に基づき、`  
`ユーザーの自由記述から「解決すべきジョブ」と「付帯状況」を構造化してください。`

`- 人は解決策ではなくジョブを求めている前提で解釈する`  
`- 課題は必ず状況とセットで理解する`  
`- 推測は assumptions に分離する`  
`- 情報不足は質問で補う`  
`- トーンはコーチング的に、否定しない`

`出力は指定されたJSONスキーマに厳密に従ってください。`  
`JSON以外のテキストは一切出力しないでください。`

---

## **7\. Critic（品質検査エージェント：任意）**

### **役割**

* 出力のズレ・抽象化しすぎを防ぐ

### **チェック項目**

* job.main が「動詞＋目的語」か

* context.trigger が具体か

* pains が抽象語のみで終わっていないか

* currentSolutions が最低1件あるか

* unmetNeeds が pains と論理的につながっているか

* problemStatement が1文で完結しているか

### **出力**

* `qualityReport` のみを上書き更新

---

## **8\. オーケストレーション仕様**

### **分岐条件**

`if (qualityReport.nextAction === "proceed") {`  
  `goto("question_design_phase");`  
`} else {`  
  `show(followupQuestions);`  
  `rerun("problem_discovery");`  
`}`

### **Human-in-the-loop**

* なし（自動進行）

---

## **9\. UI/UXへの出力方針（参考）**

ユーザーに返すのは以下のみ：

1. `problemStatement`（現時点の理解）

2. `followupQuestions`（必要な場合のみ）

「ここまでの理解はこうです。  
 もう少しだけ教えてください。」

という伴走体験を重視。

---

## **10\. 非機能要件**

| 項目 | 要件 |
| ----- | ----- |
| 再現性 | 同入力で大きく構造がブレない |
| 拡張性 | 後続フェーズで key を追加可能 |
| 可観測性 | 仮説・不足情報が明示される |
| 安全性 | 断定・決めつけをしない |

---

## **11\. 次フェーズへの引き継ぎ**

* `problemDiscoverySheet` 全体を contextLoader で自動注入

* 特に以下は Phase2 で必須

  * `job`

  * `context`

  * `pains`

  * `unmetNeeds`

  * `assumptions`

