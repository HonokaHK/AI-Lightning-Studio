# **質問設計エージェント 仕様書**

**Question Design Agent – Lean Startup Companion**

---

## **1\. 概要**

### **1.1 目的**

本エージェントは、Phase 1（課題探索）で生成された `problemStatement` をもとに、  
**課題理解を深めるための質問シート**を設計する。

* 情報の不足点を補う  
* 仮説を検証可能な形にする  
* 次フェーズ（課題定義）が迷わず進められる状態を作る

---

### **1.2 本エージェントの位置づけ**

* リーンスタートアップ伴走エージェントの **Phase 2**  
* Phase 1 の出力を **人間との対話に変換する役割**  
* Human-in-the-loop **前提フェーズ**

---

## **2\. フェーズ定義**

| 項目 | 内容 |
| ----- | ----- |
| フェーズ名 | question\_design |
| フェーズ番号 | Phase 2 |
| 主目的 | 情報補完・仮説深掘り |
| 次フェーズ | Phase 3：課題定義エージェント |
| 再実行条件 | 回答不足・曖昧な回答 |

---

## **3\. 入出力仕様**

### **3.1 入力（Input）**

| 項目 | 型 | 必須 | 説明 |
| ----- | ----- | ----- | ----- |
| problemStatement | string | 必須 | Phase1で生成された課題文 |
| problemDiscoverySheet | object | 任意 | Phase1の構造化データ |
| projectMeta | object | 任意 | 業界・制約・想定顧客 |

---

### **3.2 出力（Output）**

**保存先（Firestore）**  
`{projectId}/phase/question_design`

**出力構成**

* questionSheet  
* questionIntentMap  
* qualityReport

---

## **4\. 出力JSONスキーマ（固定）**

`{`  
  `"questionSheet": [`  
    `{`  
      `"question": "",`  
      `"category": "who | when | where | what | why | how | emotion",`  
      `"intent": "",`  
      `"priority": "high | medium | low",`  
      `"relatedField": ""`  
    `}`  
  `],`  
  `"questionIntentMap": {`  
    `"target": "which missing or uncertain part this question clarifies",`  
    `"linkedPhase1Field": ""`  
  `},`  
  `"qualityReport": {`  
    `"confidence": 0.0,`  
    `"coverage": {`  
      `"job": true,`  
      `"context": true,`  
      `"pain": true,`  
      `"emotion": true`  
    `},`  
    `"nextAction": "ask_user | proceed"`  
  `}`  
`}`

---

## **5\. 処理ロジック（アルゴリズム仕様）**

### **Step 1\. 情報ギャップ検出**

Phase 1 出力から以下を確認：

* job が具体的か  
* context（when / where / trigger）が揃っているか  
* pain の原因が不明確でないか  
* 感情・判断基準が欠けていないか

---

### **Step 2\. 質問生成（最大10問）**

* **5W1H** を必ずカバー  
* 「Why」は**重層的（最大5段）**  
* 感情面（不安・苛立ち・期待）を最低1問含める  
* 抽象質問は禁止（例：「詳しく教えてください」）

---

### **Step 3\. 質問の整理と優先度付け**

* 各質問に intent を明示  
* Phase1 のどの項目を補完するか明確化  
* 本質に近い質問を priority=high に設定

---

### **Step 4\. 品質判定**

* 10問以内に収まっているか  
* 同じ意味の質問が重複していないか  
* 次フェーズに必要な情報が網羅されているか

---

## **6\. Prompt設計（System Prompt）**

`あなたは「質問設計エージェント」です。`

`課題探索フェーズで得られた problemStatement をもとに、`  
`課題理解を深めるための質問シートを作成してください。`

`- 5W1H を必ず網羅すること`  
`- 「なぜ」を段階的に深掘りできる質問を含めること`  
`- 感情・判断基準に関する質問を最低1問含めること`  
`- 抽象的・曖昧な質問は禁止`  
`- 最大10問まで`

`出力は指定されたJSONスキーマに厳密に従ってください。`  
`JSON以外のテキストは一切出力しないでください。`

---

## **7\. 品質チェック観点（Reviewer / Critic）**

* job / context / pain / emotion を全て補えているか  
* 回答者が **具体的に答えられる質問**になっているか  
* Phase3で「解釈」が可能な情報量か

---

## **8\. オーケストレーション仕様**

`if (qualityReport.nextAction === "ask_user") {`  
  `show(questionSheet);`  
  `waitForAnswers();`  
  `rerun("question_design");`  
`} else {`  
  `goto("problem_definition_phase");`  
`}`

---

## **9\. UI/UXへの出力方針（参考）**

ユーザーには以下のみ表示：

* 「現時点でこう理解しています」  
* 質問シート（会話形式 or フォーム）  
* 「もう少しだけ教えてください」

**詰問感を出さず、伴走感を重視**

---

## **10\. 次フェーズへの引き継ぎ**

Phase 3 へ渡す必須情報：

* questionSheet  
* userAnswers（後続）  
* Phase1 の context / pain / job

---

## **ここが超重要（設計の芯）**

* Phase 1 \= **理解の仮説**  
* Phase 2 \= **仮説を壊すための質問**  
* Phase 3 \= **理解を再構築**

