# **ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä»•æ§˜**

## **ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦å›³**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web/API Frontend (Next.js)                              â”‚
â”‚ SSR / ISR / Edge Functions                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Gateway (FastAPI on Cloud Run)                      â”‚
â”‚ - REST API                                              â”‚
â”‚ - AuthZ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ (admin/user)                        â”‚
â”‚ - è‡ªå‹•APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ (OpenAPI/Swagger)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent Orchestrator (LangChain Python)                   â”‚
â”‚ - ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ PromptTemplate / LLMChain                   â”‚
â”‚ - Conversation Store (Firestore)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ External LLM API (OpenAI GPT-4o)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## **ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**

### **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**

| ãƒ¬ã‚¤ãƒ¤ | æŠ€è¡“ | é¸å®šç†ç”± |
| ----- | ----- | ----- |
| UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | V0.dev (React/Next UI) | ç”ŸæˆAIã§ãƒ©ãƒ•â†’ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’é«˜é€ŸåŒ– |
| IDE | Cursor | GPT-4çµ±åˆã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è‡ªå‹•åŒ– |
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Next.js 14 / React 18 / TypeScript | App Routerã€ä¸¦åˆ—UIã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®¹æ˜“ |
| ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | Firebase Hosting \+ Cloud Run | ä½é‹ç”¨ã‚³ã‚¹ãƒˆã€CDNã€SSRå¯¾å¿œ |

### **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**

| ãƒ¬ã‚¤ãƒ¤ | æŠ€è¡“ | é¸å®šç†ç”± |
| ----- | ----- | ----- |
| ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  | Python 3.11+ on Cloud Run | AI/ML ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒå……å®Ÿ |
| Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | FastAPI | éåŒæœŸå¯¾å¿œã€è‡ªå‹•APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€é«˜é€Ÿ |
| AIã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | LangChain (Python) | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ã€ãƒã‚§ãƒ¼ãƒ³æ§‹ç¯‰ã®æ¨™æº–åŒ– |
| LLMãƒ¢ãƒ‡ãƒ« | OpenAI GPT-4o (API) | é«˜ç²¾åº¦ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ç¢ºä¿ |
| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† | pip \+ requirements.txt | ã‚·ãƒ³ãƒ—ãƒ«ã€å†ç¾æ€§ç¢ºä¿ |

### **ãƒ‡ãƒ¼ã‚¿ & èªè¨¼**

| ãƒ¬ã‚¤ãƒ¤ | æŠ€è¡“ | é¸å®šç†ç”± |
| ----- | ----- | ----- |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Firebase Firestore (NoSQL) | ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¹ã€ãƒ•ã‚§ãƒ¼ã‚ºå‡ºåŠ›ã®é«˜é€Ÿä¿å­˜ |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | Google Cloud Storage | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ/ã‚¢ã‚»ãƒƒãƒˆä¿ç®¡ |
| èªè¨¼ | Firebase Auth (SAML/OIDC) | ä¼æ¥­SSOå¯¾å¿œ |

### **DevOps**

| ãƒ¬ã‚¤ãƒ¤ | æŠ€è¡“ | é¸å®šç†ç”± |
| ----- | ----- | ----- |
| CI/CD | GitHub Actions | Firebase/Cloud Runè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ |
| IaC | Terraform \+ Firebase Extensions | å†ç¾æ€§ã€ãƒãƒ«ãƒç’°å¢ƒç®¡ç† |
| ç›£è¦– | Cloud Logging/Monitoring \+ Sentry | SLA 99.9%ç¶­æŒ |

## **ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«**

### **ERå›³**

```
erDiagram
    Project ||--o{ Phase : contains
    Project ||--o{ AuditLog : tracks
    Phase ||--o{ AuditLog : tracks
    
    Project {
        string id PK
        string name
        string ownerUid FK
        string status
        timestamp createdAt
        timestamp updatedAt
    }
    
    Phase {
        string id PK
        string projectId FK
        string name
        json input
        json output
        timestamp startedAt
        timestamp finishedAt
    }
    
    AuditLog {
        string id PK
        string projectId FK
        string phaseId FK
        string action
        string actorUid
        json metadata
        timestamp at
    }
```

### **Firestoreã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ§‹é€ **

```
/projects/{projectId}
  - name: string
  - ownerUid: string
  - status: "draft" | "in_progress" | "completed"
  - createdAt: timestamp
  - updatedAt: timestamp
  
  /phases/{phaseName}
    - name: string (e.g., "problem_extraction")
    - input: object
    - output: object
    - startedAt: timestamp
    - finishedAt: timestamp
    
/auditLogs/{logId}
  - projectId: string
  - phaseId: string
  - action: string
  - actorUid: string
  - metadata: object
  - at: timestamp
```

## **ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**

### **ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè¡Œãƒ•ãƒ­ãƒ¼**

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ•ã‚§ãƒ¼ã‚ºã‚’é–‹å§‹
   â†“
2. Frontend â†’ API Gateway (èªè¨¼ãƒã‚§ãƒƒã‚¯)
   â†“
3. API Gateway â†’ Agent Orchestrator
   â†“
4. Agent Orchestrator ãŒ:
   - Firestoreã‹ã‚‰å‰ãƒ•ã‚§ãƒ¼ã‚ºã®å‡ºåŠ›ã‚’å–å¾—
   - LLMChain ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ³¨å…¥
   - OpenAI APIå‘¼ã³å‡ºã—
   â†“
5. LLMå¿œç­”ã‚’å—ã‘å–ã‚Š
   â†“
6. å‡ºåŠ›ã‚’Firestoreã«ä¿å­˜
   â†“
7. Frontend ã«çµæœã‚’è¿”ã™
```

### **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé€£æº**

ã™ã¹ã¦ã®ãƒ•ã‚§ãƒ¼ã‚ºå‡ºåŠ›ã¯ä»¥ä¸‹ã®ãƒ‘ã‚¹ã§ä¿å­˜:

```
/projects/{projectId}/phases/{phaseName}
```

æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè¡Œæ™‚ã€`contextLoader`ãŒè‡ªå‹•çš„ã«å‰ãƒ•ã‚§ãƒ¼ã‚ºã®å‡ºåŠ›ã‚’èª­ã¿è¾¼ã¿ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ³¨å…¥ã—ã¾ã™ã€‚

## **ğŸ›ï¸ ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ**

### **GCP ãƒªã‚½ãƒ¼ã‚¹**

```
Project: ai-lightning-studio-prod
â”œâ”€â”€ Cloud Run
â”‚   â””â”€â”€ api-service (backend)
â”œâ”€â”€ Firestore
â”‚   â””â”€â”€ (default database)
â”œâ”€â”€ Cloud Storage
â”‚   â””â”€â”€ project-assets bucket
â”œâ”€â”€ Cloud Logging
â””â”€â”€ Cloud Monitoring
```

### **Firebase ãƒªã‚½ãƒ¼ã‚¹**

```
Firebase Project: ai-lightning-studio
â”œâ”€â”€ Authentication
â”‚   â”œâ”€â”€ Email/Password
â”‚   â””â”€â”€ SAML/OIDC (enterprise)
â”œâ”€â”€ Hosting
â”‚   â””â”€â”€ web app (frontend)
â””â”€â”€ Extensions
    â””â”€â”€ (future: Stripe, SendGrid, etc.)
```

### **Terraform ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ**

```
infra/
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â””â”€â”€ terraform.tfvars
â”‚   â”œâ”€â”€ staging/
â”‚   â””â”€â”€ production/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ cloud-run/
â”‚   â”œâ”€â”€ firestore/
â”‚   â”œâ”€â”€ storage/
â”‚   â””â”€â”€ monitoring/
â””â”€â”€ shared/
    â””â”€â”€ variables.tf
```

## **ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ & éæ©Ÿèƒ½è¦ä»¶**

### **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**

| é …ç›® | å®Ÿè£… |
| ----- | ----- |
| èªè¨¼ | Firebase Auth (JWT) |
| èªå¯ | Cloud Run IAM \+ ã‚«ã‚¹ã‚¿ãƒ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ |
| ãƒ‡ãƒ¼ã‚¿æš—å·åŒ– (ä¿ç®¡æ™‚) | AES-256 (GCPæ¨™æº–) |
| ãƒ‡ãƒ¼ã‚¿æš—å·åŒ– (è»¢é€æ™‚) | TLS 1.3 |
| APIã‚­ãƒ¼ç®¡ç† | Secret Manager |
| ç›£æŸ»ãƒ­ã‚° | Cloud Audit Logs \+ Firestore audit collection |

### **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**

| é …ç›® | è¦ä»¶ |
| ----- | ----- |
| åŒæ™‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‡¦ç† | 50 |
| å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ | â‰¤ 8ç§’ |
| LLM API ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 30ç§’ |

### **å¯ç”¨æ€§**

| é …ç›® | è¦ä»¶ |
| ----- | ----- |
| SLA | 99.9% / æœˆ |
| Cloud Runæœ€å°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ | 1 (ã‚¦ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ) |
| Cloud Runæœ€å¤§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ | 10 |

### **æ‹¡å¼µæ€§**

| é …ç›® | å®Ÿè£… |
| ----- | ----- |
| æ–°ãƒ•ã‚§ãƒ¼ã‚ºè¿½åŠ  | Prompt \+ Chainè¿½åŠ ã®ã¿ |
| å¤šè¨€èªå¯¾å¿œ | LLM system promptã§è¨€èªè‡ªå‹•æ¤œçŸ¥ (JA/EN) |

### **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼**

| é …ç›® | å®Ÿè£… |
| ----- | ----- |
| OpenAI API | data\_opt\_out è¨­å®š |
| ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤å¾Œ30æ—¥ã§å®Œå…¨å‰Šé™¤ |

## **ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**

| ãƒ¬ãƒ™ãƒ« | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | ã‚«ãƒãƒ¼ç¯„å›² |
| ----- | ----- | ----- |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | Vitest \+ React Testing Library | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ |
| AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚¹ãƒˆ | PromptLayer Diff \+ Golden File | å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå›å¸° |
| çµ±åˆãƒ†ã‚¹ãƒˆ | Jest \+ SuperTest | API & Firestoreé€£æº |
| E2Eãƒ†ã‚¹ãƒˆ | Cypress Cloud | UIå…¨ãƒ•ãƒ­ãƒ¼ (10ãƒ•ã‚§ãƒ¼ã‚º) |
| è² è·ãƒ†ã‚¹ãƒˆ | k6 | RPS 100 / 10åˆ† |

## **ğŸš€ CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**

### **GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**

```
# .github/workflows/deploy.yml (æ¦‚è¦)

on:
  push:
    branches: [main, develop]
  pull_request:

jobs:
  test:
    - lint
    - unit test
    - integration test
    
  build:
    - Next.js build
    - Docker image build (backend)
    
  deploy:
    - Firebase Hosting (frontend)
    - Cloud Run (backend)
    - Terraform apply (infra changes)
```

### **ç’°å¢ƒåˆ¥ãƒ‡ãƒ—ãƒ­ã‚¤**

| ãƒ–ãƒ©ãƒ³ãƒ | ç’°å¢ƒ | è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ |
| ----- | ----- | ----- |
| `feature/*` | Preview (Firebase) | âœ… PRæ™‚ |
| `develop` | Staging | âœ… ãƒãƒ¼ã‚¸æ™‚ |
| `main` | Production | âœ… ãƒãƒ¼ã‚¸æ™‚ |

## **ğŸ“ˆ ç›£è¦– & ã‚¢ãƒ©ãƒ¼ãƒˆ**

### **ãƒ¡ãƒˆãƒªã‚¯ã‚¹**

* API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ   
* LLM API å‘¼ã³å‡ºã—å›æ•° & ã‚³ã‚¹ãƒˆ  
* ã‚¨ãƒ©ãƒ¼ç‡ (4xx, 5xx)  
* Cloud Run ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°

### **ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶**

* ã‚¨ãƒ©ãƒ¼ç‡ \> 5% (5åˆ†é–“)  
* ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  \> 10ç§’ (P95, 5åˆ†é–“)  
* OpenAI API ã‚¨ãƒ©ãƒ¼ \> 10å›/åˆ†

### **ãƒ­ã‚°é›†ç´„**

* Cloud Logging â†’ BigQuery (é•·æœŸä¿å­˜)  
* Sentry (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼)

## **ğŸ”„ ç½å®³å¾©æ—§ (DR)**

| é …ç›® | æˆ¦ç•¥ |
| ----- | ----- |
| RPO (ç›®æ¨™å¾©æ—§æ™‚ç‚¹) | 1æ™‚é–“ |
| RTO (ç›®æ¨™å¾©æ—§æ™‚é–“) | 4æ™‚é–“ |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | Firestoreè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— (æ—¥æ¬¡) |
| ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | asia-northeast1 (æ±äº¬) |

## **ğŸ¯ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**

### **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**

* Next.js ISR (Incremental Static Regeneration)  
* ç”»åƒæœ€é©åŒ– (next/image)  
* Code splitting (React.lazy)

### **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**

* LLMå¿œç­”ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° (Server-Sent Events)  
* Firestore ã‚¯ã‚¨ãƒªæœ€é©åŒ– (è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)  
* Cloud Run ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå¯¾ç­– (min-instances=1)

### **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**

* OpenAI API token budgeting  
* Embedding ã‚­ãƒ£ãƒƒã‚·ãƒ¥  
* Cloud Run ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®šèª¿æ•´

## **ğŸ“‹ é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—è©³ç´°**

### **1\. GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ**

```shell
# gcloud CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œ
gcloud projects create ai-lightning-studio-dev
gcloud config set project ai-lightning-studio-dev

# å¿…è¦ãªAPIã‚’æœ‰åŠ¹åŒ–
gcloud services enable \
  run.googleapis.com \
  firestore.googleapis.com \
  storage.googleapis.com \
  secretmanager.googleapis.com
```

### **2\. Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–**

```shell
firebase login
firebase projects:create ai-lightning-studio-dev
firebase use ai-lightning-studio-dev
firebase init hosting
firebase init firestore
```

### **3\. TerraformåˆæœŸåŒ–**

```shell
cd infra/environments/dev
terraform init
terraform plan
terraform apply
```

### **4\. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®š**

```shell
# OpenAI API Key
echo -n "sk-..." | gcloud secrets create openai-api-key --data-file=-

# Firebaseè¨­å®š
firebase apps:sdkconfig web > firebase-config.json
```

## **ğŸ”— å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº**

| ã‚µãƒ¼ãƒ“ã‚¹ | ç”¨é€” | SDK/ãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| ----- | ----- | ----- |
| OpenAI | LLM API | `openai` (Python) |
| Firebase | Auth, Hosting, Firestore | `firebase-admin` (Python) |
| GCP | Cloud Run, Storage, Logging | `google-cloud-*` (Python) |
| Sentry | ã‚¨ãƒ©ãƒ¼è¿½è·¡ | `sentry-sdk` (Python) |

## **ğŸ¤ ãƒ•ãƒ­ãƒ³ãƒˆãƒ»ãƒãƒƒã‚¯é€£æºæ–¹æ³•**

### **2äººä¸¦è¡Œé–‹ç™ºã®ãŸã‚ã®ä»•çµ„ã¿**

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯**å®Œå…¨åˆ†æ¥­å‹**ã§é€²ã‚ã¾ã™ã€‚ãŠäº’ã„ãŒç‹¬ç«‹ã—ã¦é–‹ç™ºã§ãã‚‹ã‚ˆã†ã€ä»¥ä¸‹ã®ä»•çµ„ã¿ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

### **APIä»•æ§˜æ›¸ï¼ˆSwaggerï¼‰ã§é€£æº**

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ **FastAPI** ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€APIä»•æ§˜æ›¸ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ‹…å½“:**

```shell
# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
uvicorn app.main:app --reload --port 8000

# Swagger UIã§ä»•æ§˜ã‚’ç¢ºèªãƒ»å…±æœ‰
# http://localhost:8000/docs
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ‹…å½“:**

1. `http://localhost:8000/docs` ã«ã‚¢ã‚¯ã‚»ã‚¹  
2. APIã®ä»•æ§˜ã‚’ç¢ºèª  
3. ã€ŒTry it outã€ãƒœã‚¿ãƒ³ã§å®Ÿéš›ã«è©¦ã›ã‚‹  
4. ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚’ç¢ºèªã—ã¦ã‚³ãƒ¼ãƒ‰ã«åæ˜ 

### **ãƒ¢ãƒƒã‚¯API vs å®ŸAPI ã®åˆ‡ã‚Šæ›¿ãˆ**

é–‹ç™ºåˆæœŸã¯**ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿**ã§é€²ã‚ã€APIãŒã§ããŸã‚‰**å®ŸAPI**ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚

#### **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ä¾‹**

```ts
// apps/web/lib/api-client.ts

const USE_MOCK = process.env.NEXT_PUBLIC_USE_MOCK === 'true';
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

// ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
const MOCK_DATA = {
  phase1: { problem_statement: "ã‚µãƒ³ãƒ—ãƒ«èª²é¡Œ..." },
  phase2: { questions: ["è³ªå•1", "è³ªå•2"] },
  // ...
};

export async function executePhase(
  projectId: string,
  phaseName: string,
  input: any
) {
  // ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
  if (USE_MOCK) {
    console.log('ğŸ”· ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰: APIã¯å‘¼ã°ã‚Œã¦ã„ã¾ã›ã‚“');
    return MOCK_DATA[phaseName];
  }
  
  // å®ŸAPIã‚’å‘¼ã¶
  const response = await fetch(
    `${API_URL}/api/v1/projects/${projectId}/phases/${phaseName}`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(input),
    }
  );
  
  return await response.json();
}
```

#### **ç’°å¢ƒå¤‰æ•°ã§åˆ‡ã‚Šæ›¿ãˆ**

**ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§é–‹ç™º:**

```shell
# apps/web/.env.local
NEXT_PUBLIC_USE_MOCK=true
```

**å®ŸAPIã«æ¥ç¶š:**

```shell
# apps/web/.env.local
NEXT_PUBLIC_USE_MOCK=false
NEXT_PUBLIC_API_URL=http://localhost:8000
```

### **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã®åŒæ™‚èµ·å‹•**

**2ã¤ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§åŒæ™‚ã«èµ·å‹•:**

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰:

```shell
cd backend
source venv/bin/activate
uvicorn app.main:app --reload --port 8000
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰:

```shell
cd apps/web
npm run dev
```

ã“ã‚Œã§ä»¥ä¸‹ã®URLãŒä½¿ãˆã¾ã™:

* ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: http://localhost:3000  
* ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API: http://localhost:8000  
* Swagger UI: http://localhost:8000/docs

### **CORSè¨­å®šï¼ˆé‡è¦ï¼‰**

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ3000ç•ªãƒãƒ¼ãƒˆï¼‰ã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ8000ç•ªãƒãƒ¼ãƒˆï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã€CORSè¨­å®šãŒå¿…è¦ã§ã™ã€‚

```py
# backend/app/main.py

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(title="AI Lightning Studio API")

# CORSè¨­å®šï¼ˆé–‹ç™ºç’°å¢ƒç”¨ï¼‰
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000",  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
        "http://127.0.0.1:3000",
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### **APIä»•æ§˜ã®ä¾‹**

#### **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆAPI**

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /api/v1/projects`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**

```json
{
  "name": "æ–°è¦äº‹æ¥­ã‚¢ã‚¤ãƒ‡ã‚¢æ¤œè¨"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "id": "proj_abc123",
  "name": "æ–°è¦äº‹æ¥­ã‚¢ã‚¤ãƒ‡ã‚¢æ¤œè¨",
  "status": "draft",
  "created_at": "2025-01-10T10:00:00Z"
}
```

#### **ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè¡ŒAPI**

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /api/v1/projects/{project_id}/phases/{phase_name}`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆPhase 1ã®ä¾‹ï¼‰:**

```json
{
  "user_input": "ç¤¾å†…ã®æƒ…å ±å…±æœ‰ãŒã†ã¾ãã„ã£ã¦ã„ãªã„"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "problem_statement": "ç¤¾å†…ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®éåŠ¹ç‡æ€§ã«ã‚ˆã‚Šã€ãƒãƒ¼ãƒ é–“ã®æƒ…å ±å…±æœ‰ãŒæ»ã‚Šã€æ¥­å‹™ã®é‡è¤‡ã‚„æ„æ€æ±ºå®šã®é…å»¶ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã€‚"
}
```

### **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**

APIã‚¨ãƒ©ãƒ¼ã¯ä»¥ä¸‹ã®å½¢å¼ã§è¿”ã•ã‚Œã¾ã™:

```json
{
  "detail": "OpenAI APIã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ",
  "status_code": 500
}
```

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®å‡¦ç†ä¾‹:

```ts
try {
  const result = await executePhase(projectId, 'phase1', input);
  // æˆåŠŸæ™‚ã®å‡¦ç†
} catch (error) {
  console.error('APIã‚¨ãƒ©ãƒ¼:', error);
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
  alert('å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
}
```

### **ä¸»è¦Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (requirements.txt)**

```
# Web Framework
fastapi==0.109.0
uvicorn[standard]==0.27.0
python-multipart==0.0.6

# AI/ML
langchain==0.1.0
langchain-openai==0.0.5
openai==1.10.0

# Firebase & GCP
firebase-admin==6.4.0
google-cloud-firestore==2.14.0
google-cloud-storage==2.14.0
google-cloud-logging==3.9.0

# Utilities
pydantic==2.5.0
pydantic-settings==2.1.0
python-dotenv==1.0.0

# Monitoring
sentry-sdk[fastapi]==1.40.0

# Testing
pytest==7.4.0
pytest-asyncio==0.21.0
httpx==0.26.0
```

### **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¸»è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (package.json)**

```json
{
  "dependencies": {
    "next": "^14.1.0",
    "react": "^18.2.0",
    "typescript": "^5.3.0",
    "firebase": "^10.7.0",
    "tailwindcss": "^3.4.0"
  }
}
```

## **ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯**

* [Next.js App Router](https://nextjs.org/docs/app)  
* [LangChain.js ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://js.langchain.com/)  
* [Firebase ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://firebase.google.com/docs)  
* [Cloud Run ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/run/docs)  
* [Terraform GCP Provider](https://registry.terraform.io/providers/hashicorp/google/latest/docs)

